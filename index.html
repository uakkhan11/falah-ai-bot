  <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Falāh AI Bot</title>

  <!-- PWA manifest -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#205081"/>
  <link rel="icon" href="icon-192.png" sizes="192x192" />

  <style>
    body { font-family: sans-serif; padding: 1rem; max-width: 600px; margin: auto; }
    fieldset { margin-bottom: 1.5rem; }
    button { margin-right: .5rem; padding: .5rem 1rem; }
    h1 { margin-bottom: 1rem; }
  </style>
</head>

  <!-- Inline form‐handler code -->

  <!-- Load config first -->
  <script src="config.js"></script>
  <!-- Then load your core logic -->
  <script src="tradeLogic.js"></script>
  <!-- Then your CSV & Telegram scripts -->
  <script src="telegram.js"></script>
  <script src="csv.js"></script>

  
<body>
  <h1>Falāh AI Bot Settings</h1>

  <!-- Settings Form -->
  <form id="settingsForm">
    <fieldset>
      <legend>Trading Configuration</legend>

      <label>
        Brokerage Capital (₹):
        <input id="capitalInput" type="number" min="0"/>
      </label>
      <br/><br/>

      <label>
        Max Trades per Day:
        <input id="maxTradesInput" type="number" min="1"/>
      </label>
      <br/><br/>

      <label>
        Select Broker:
        <select id="brokerSelect">
          <option>AngelOne</option>
          <option>Zerodha</option>
          <option>Upstox</option>
          <option>Groww</option>
          <option>5Paisa</option>
        </select>
      </label>
      <br/><br/>

      <button type="submit">Save Settings</button>
    </fieldset>
  </form>

  <!-- Quick Actions -->
  <h2>Quick Actions</h2>
  <button onclick="runTradingCycle()">Run Trading Cycle</button>
  <button onclick="sendTelegramMessage('✅ Test Telegram from Falāh!')">Test Telegram</button>
  <button onclick="downloadCSV()">Download Trades CSV</button>

  <!-- Inline Save & Load Settings Logic -->
  <script>
    // Saves settings into localStorage
    function saveSettings() {
      const capital    = Number(document.getElementById('capitalInput').value) || 0;
      const maxTrades  = Number(document.getElementById('maxTradesInput').value) || 0;
      const brokerName = document.getElementById('brokerSelect').value;
      const config = { capital, maxTrades, brokerName };
      localStorage.setItem('falahConfig', JSON.stringify(config));
      console.log('Saved config:', config);
    }

    // On load: populate form and wire up save
    document.addEventListener('DOMContentLoaded', () => {
      // Populate from storage
      const saved = JSON.parse(localStorage.getItem('falahConfig') || '{}');
      if (saved.capital)    document.getElementById('capitalInput').value   = saved.capital;
      if (saved.maxTrades)  document.getElementById('maxTradesInput').value = saved.maxTrades;
      if (saved.brokerName) document.getElementById('brokerSelect').value   = saved.brokerName;

      // Intercept form submit
      const form = document.getElementById('settingsForm');
      form.addEventListener('submit', e => {
        e.preventDefault();  // prevent page reload
        saveSettings();
        alert('Settings saved!');
      });

      // Register service worker for PWA
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('service-worker.js');
      }
    });
  </script>

  <!-- External Scripts -->
  <script src="config.js"></script>
  <script src="telegram.js"></script>
  <script src="csv.js"></script>
  <script src="broker.js"></script>
  <script src="tradeLogic.js"></script>
</body>
</html>
